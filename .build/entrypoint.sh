#!/bin/sh -l

set -e

input_paths="$1"
config_file="$2"

### Function Header ###########################################################
Header() {
  ##########
  # Prints #
  ##########
  echo "---------------------------------------------"
  echo "-- GitHub Actions TYPO3 PHPStan ---"
  echo "---------------------------------------------"
  echo "TYPO3 PHPStan source code can be found at:"
  echo " - https://github.com/TYPO3-Continuous-Integration/TYPO3-CI-PHPStan"
  echo "---------------------------------------------"
}

### Function InstallDependencies #############################################################
InstallDependencies() {
  ##########
  # Prints #
  ##########
  echo "---------------------------------------------"
  echo "-- Installing dependencies... ---"
  echo "---------------------------------------------"
  sh -c "composer install --no-progress"
}

### Function Check #############################################################
Check() {
  ##########
  # Prints #
  ##########
  echo "---------------------------------------------"
  echo "-- Running check... ---"
  echo "---------------------------------------------"
  sh -c "phpstan analyse $input_paths -c $config_file"
}

#### Function Footer ###########################################################
Footer() {
  ##########
  # Prints #
  ##########
  echo "----------------------------------------------"
  echo "----------------------------------------------"
  echo "The script has completed"
  echo "----------------------------------------------"
  echo "----------------------------------------------"
}

################################################################################
############################### MAIN ###########################################
################################################################################

##########
# Header #
##########
Header

##########
# InstallDependencies #
##########
InstallDependencies

##########
# Check #
##########
Check

##########
# Footer #
##########
Footer
